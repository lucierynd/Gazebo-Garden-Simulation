ekf_filter_node:
  ros__parameters:
    # Frequency and timing
    frequency: 30.0
    sensor_timeout: 0.1
    two_d_mode: true              # 2D robot
    transform_time_offset: 0.0
    transform_timeout: 0.5
    print_diagnostics: true
    use_sim_time: true

    # Frame configuration
    map_frame: map
    odom_frame: odom
    base_link_frame: base_link
    world_frame: odom          

    # Publish the odom -> base_link transform
    publish_tf: true

    # ========== SENSOR 1: rf2o Laser Odometry ==========
    odom0: /odom_rf2o
    # Config order: x, y, z, roll, pitch, yaw, vx, vy, vz, vroll, vpitch, vyaw, ax, ay, az
    odom0_config: [true,  true,  false,    # x, y, z (use x, y from lidar odom)
                   false, false, true,     # roll, pitch, yaw (use yaw from lidar)
                   true,  true,  false,    # vx, vy, vz (use vx, vy)
                   false, false, true,     # vroll, vpitch, vyaw (use vyaw)
                   false, false, false]    # ax, ay, az (not used)
    odom0_queue_size: 10
    odom0_differential: false
    odom0_relative: false

    # ========== SENSOR 2: IMU ==========
    imu0: /imu/data
    # For 2D robot: use orientation (yaw) and angular velocity (vyaw)
    # Also use linear acceleration for better velocity estimation
    imu0_config: [false, false, false,     # x, y, z (IMU doesn't provide position)
                  false, false, true,      # roll, pitch, yaw (use yaw)
                  false, false, false,     # vx, vy, vz (not from IMU)
                  false, false, true,      # vroll, vpitch, vyaw (use angular velocity)
                  true,  true,  false]     # ax, ay, az (use linear acceleration x, y)
    imu0_queue_size: 10
    imu0_differential: false
    imu0_relative: true                    # Start from current orientation
    imu0_remove_gravitational_acceleration: true
    imu0_pose_rejection_threshold: 0.8
    imu0_twist_rejection_threshold: 0.8
    imu0_linear_acceleration_rejection_threshold: 0.8

    # Process noise covariance (tune these based on your sensors)
    # Smaller values = trust predictions more, larger = trust measurements more
    process_noise_covariance: [0.05,  0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,
                               0.0,   0.05,  0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,
                               0.0,   0.0,   0.06,  0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,
                               0.0,   0.0,   0.0,   0.03,  0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,
                               0.0,   0.0,   0.0,   0.0,   0.03,  0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,
                               0.0,   0.0,   0.0,   0.0,   0.0,   0.03,  0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,
                               0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.025, 0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,
                               0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.025, 0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,
                               0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.04,  0.0,   0.0,   0.0,   0.0,   0.0,   0.0,
                               0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.01,  0.0,   0.0,   0.0,   0.0,   0.0,
                               0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.01,  0.0,   0.0,   0.0,   0.0,
                               0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.02,  0.0,   0.0,   0.0,
                               0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.01,  0.0,   0.0,
                               0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.01,  0.0,
                               0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.015]